# Changelog

所有显著的项目变化都将被记录在此文件中。

该项目遵循 [Semantic Versioning](https://semver.org/)。

## [Unreleased]

## [3.3.1] - 2026-01-30

### Added

- 🧰 **Subagent 详情查看** - 支持在会话详情侧边栏中查看 Task 工具调用的 subagent 完整对话记录，包括消息列表展示、视图切换导航和返回主对话功能（仅 Claude 渠道支持）

## [3.3.0] - 2026-01-28

### Added

- 🧰 **技能文件上传** - 支持通过 ZIP 文件或文件夹上传安装技能，文件大小限制 50MB，三层安全验证
- 🔍 **GitHub 版本检测** - 支持 GitHub 仓库版本检测和更新提示，自动重试机制应对网络中断
- 🔄 **技能重新安装** - 支持卸载后 24 小时内从缓存重新安装，实时倒计时显示剩余时间
- ⚙️ **本地覆盖更新** - 上传同名技能时自动版本对比，支持强制覆盖已安装技能
- 🏷️ **平台选择上传** - 上传技能完成后弹出平台选择（Claude/Codex/Gemini），默认全选
- 🔧 **按技能项更新** - 技能列表项提供"设置更新"入口，配置 GitHub 地址作为更新源
- 🚀 **启动自动检测** - 服务启动时自动对已配置更新源的技能执行更新检测
- 💡 **更新状态展示** - 列表项展示更新可用状态，支持手动更新覆盖所有已安装平台

### Changed

- 🗑️ **移除全局更新入口** - 移除全局"检查更新"入口与弹窗，改为按技能项更新流程

## [3.2.0] - 2026-01-26

### Added

- 🧰 **Skill 管理增强** - 全局 Skill 管理 Drawer，支持缓存、禁用/启用技能，Claude/Codex/Gemini 三平台统一显示技能数量

## [3.1.1] - 2026-01-08

### Added

- 🧭 **临时规范显示** - 在规范列表中显示临时规范（来自 changes/*/specs/），使用琥珀色视觉系统区分，支持混合排序

## [3.1.0] - 2026-01-07

### Added

- 🎨 **对话详情 UI 增强** - 工具调用可视化渲染（TodoWrite→复选列表、AskUserQuestion→表格、Bash/Grep→终端风格），消息过滤栏支持多选过滤
- 🌈 **后端颜色方案** - Claude/Codex/Gemini/工具调用使用不同主题色区分，提升可读性
- 📦 **智能折叠** - JSON 字符串超过 10 行自动折叠，思考/推理内容特殊样式展示
- ⚡ **虚拟滚动优化** - 对话详情页采用虚拟滚动，大量消息场景下性能显著提升

## [3.0.3] - 2026-01-05

### Changed

- 💻 **统一终端启动器** - 移除设置中的终端工具配置项，【使用对话】改为下拉菜单，支持复制命令和多终端启动选择

## [3.0.2] - 2026-01-04

### Added

- 🔄 GitHub 更新检测与一键更新（支持 Web UI 徽章与 `ct update`）
- 🖥️ Web UI 新增"安装为桌面应用"按钮（PWA）

## [3.0.0] - 2026-01-04

### 🎉 重大更新：品牌升级 CCToolbox

### Added

- 🗑️ **会话回收站** - 7天误删保护，支持批量删除、可视化恢复和永久清理
- 🏷️ **会话标签功能** - 支持为会话添加最多4个标签，标签颜色自动生成，支持 `tag:关键词` 搜索
- 🔍 **渠道搜索过滤** - 实时搜索渠道列表，支持按名称/API地址/模型模糊匹配和高亮显示
- ⚙️ **增强渠道管理** - Gemini渠道写入/清空配置、Codex模型配置、三平台"正在使用"标识
- 💻 **VSCode 终端集成** - macOS支持VSCode作为终端选项，自动打开项目并复制命令到剪贴板
- 🤖 **AI 助手功能** - 支持 Ollama/OpenAI/Gemini，自动生成会话别名和标签，智能对话总结
- 🧰 **Serena UI** - Serena MCP可视化管理界面，支持项目记忆管理和语义浏览器
- 📊 **OpenSpec UI** - 规范驱动开发可视化界面，包含仪表盘、项目、规范、变更、档案、设置六大模块
- 🧭 **OpenSpec UI 增强** - 变更/归档进度条、任务折叠描述、项目预览/编辑切换、列表关键词搜索
- 🔄 **渠道全部展开/收起** - 一键切换所有渠道卡片的展开/收起状态

### Fixed

- 🧱 **全屏层级修复** - 修复 OpenSpec 详情页全屏遮罩层级问题
- 📝 **代码块对齐修复** - 修复 md-editor-v3 代码块行号与代码文本对齐问题
- 🔄 **同步刷新增强** - 修复同步按钮点击后详情页内容不更新的问题
- 📁 **Gemini .env 修复** - 修复所有渠道关闭时 .env 文件仍包含配置的问题
- 🖥️ **Warp 终端修复** - 使用 Launch Configuration 修复 Warp 终端命令未执行问题

### Changed

- 🏷️ **品牌升级** - 项目品牌统一为 CCToolbox
- 📦 **包名更新** - npm 包名切换为 `cctoolbox`
- 📁 **配置迁移** - 配置目录迁移到 `~/.claude/cctoolbox/`，自动迁移并保留旧配置

---

## [2.2.8] - 2025-12-22

### Added

- 🚀 **智能安装功能** - 一键配置 Claude Code / Codex / Gemini，自动检测安装、生成配置、添加渠道
- ✨ **品牌更新** - 主菜单标题改为 "Vibe Coding 会话管理工具"

### Improved

- 🔧 配置文件自动备份保护，敏感文件自动设置 600 权限
- 💡 API Key 输入遮盖，安装进度实时显示

### Fixed

- 🐛 修复 Codex/Gemini 配置格式匹配问题

---

## [2.2.0] - 2025-12-08

### Added

- 🔔 **任务完成通知** - 新增通知设置，支持系统通知（卡片/弹窗）和飞书机器人通知，跨平台支持 macOS/Windows/Linux
- 📊 **冻结渠道显示** - 代理控制面板显示各类型冻结渠道数量

### Improved

- ⚡ **调度器优化** - 移除渠道缓存签名机制，每次直接读取最新配置
- 🔧 **代理超时配置** - 增加代理连接和请求超时时间至 2 分钟
- 📦 **请求体限制** - 提高请求体大小限制至 100MB
- 🎯 **错误提示优化** - 区分渠道冻结和并发上限的错误信息

### Fixed

- 🐛 修复渠道配置变更后调度器未及时刷新的问题

---

## [2.1.0] - 2025-12-06

### Added

- 渠道卡片新增单渠道速度测试按钮，支持快速测试单个渠道连通性
- 测试结果直接展示在卡片下方，包含延迟、状态码等信息

### Fixed

- 修复 Codex 渠道速度测试使用错误的 API 路径问题
- 修复 Gemini 渠道速度测试未传递 channelType 参数问题
- Codex 速度测试现在使用正确的 Responses API 格式（流式响应）
- Gemini 速度测试现在使用渠道配置的模型而非硬编码模型

### Changed

- 移除代理服务器的冗余调试日志，减少控制台输出
- 优化批量速度测试的前端超时时间

## [2.0.2] - 2025-12-02

### 🎉 重大更新：MCP 管理 & Prompts 管理 & Skills 技能 & 多模型预设

### Added

#### 🔌 MCP 服务器管理

- 全新 MCP (Model Context Protocol) 服务器管理模块
- 支持三种传输类型：stdio、http、sse
- 多平台同步：Claude / Codex / Gemini 配置一键同步
- 15+ 内置预设模板（filesystem、fetch、memory、github、puppeteer、playwright 等）
- 已安装预设自动识别，禁用重复添加
- 智能配置解析：支持粘贴 JSON 配置快速导入，自动修复不完整片段
- 一键测试 MCP 服务器连接状态
- 实时状态监控：在线/异常/测试中状态指示
- 配置导出：支持 JSON、Claude 格式、Codex TOML 格式
- 服务器卡片拖拽排序

#### 📝 Prompts 系统提示词管理

- 全新 Prompts 提示词预设管理模块
- 支持创建、编辑、删除自定义提示词预设
- 内置模板：代码审查专家、调试专家等
- 多平台同步：一键同步到 `CLAUDE.md`、`AGENTS.md`、`GEMINI.md`
- 支持从现有文件导入提示词
- 激活/停用管理，灵活切换不同场景

#### 🧩 Skills 技能管理

- 全新 Claude Code Skills 技能管理模块
- 支持从 GitHub 仓库获取技能列表（默认 anthropics/skills 官方仓库）
- 支持添加自定义仓库源，灵活扩展技能来源
- 技能一键安装/卸载到 `~/.claude/skills/`
- 技能详情查看，包含描述、用法、参数说明
- 支持搜索和筛选（全部/已安装/未安装）
- 支持创建自定义本地技能

#### 🌐 多模型预设支持

- 渠道表单新增预设选择器，快速配置不同 AI 服务商
- 内置预设：
  - **Claude 官方** - Anthropic 原版 API
  - **DeepSeek** - DeepSeek-V3.2-Exp
  - **智谱 GLM** - glm-4.7 / glm-4.5-air
  - **Kimi K2** - kimi-k2-thinking
  - **MiniMax** - MiniMax-M2.1
  - **通义千问** - qwen3-max
  - **豆包 Seed** - doubao-seed-code-preview-latest
- 选择预设后自动填充 baseUrl 和模型配置
- 切换渠道时自动写入对应模型环境变量

#### 🔗 渠道级代理配置

- 每个渠道可单独配置代理地址（proxyUrl）
- 支持直连模式：将代理写入 `HTTPS_PROXY`/`HTTP_PROXY` 环境变量
- 支持代理模式：通过 `https-proxy-agent` 在代理服务器中路由请求

#### ⚡ 渠道速度测试

- 全新渠道速度测试功能
- 支持测试所有渠道的 API 响应延迟
- 按渠道类型筛选（Claude/Codex/Gemini）
- 测试摘要统计（成功/失败/平均延迟）
- 结果可视化展示，延迟分级着色

#### ⚠️ 环境变量冲突检测

- 启动时自动检测系统环境变量冲突
- 检测 `ANTHROPIC_API_KEY`、`OPENAI_API_KEY`、`GEMINI_API_KEY` 等敏感变量
- 检测 shell 配置文件（~/.zshrc、~/.bashrc 等）
- 提供详细的冲突来源和清理建议
- 支持批量选择清理或"不再提醒"

### Improved

- 🎨 **UI/UX 优化**
  - MCP/Prompts/Skills 管理抽屉式界面，不打断主流程
  - 卡片 hover 显示操作按钮
  - 平台开关一键切换
  - 统计信息实时更新

### Technical

- 🏗️ **后端架构**

  - 新增 `mcp-service.js` MCP 服务层
  - 新增 `prompts-service.js` 提示词服务层
  - 新增 `skill-service.js` 技能服务层
  - 新增 `speed-test.js` 速度测试服务
  - 新增 `env-checker.js` 环境变量检测服务
  - 新增 `env-manager.js` 环境变量管理服务
  - 渠道数据结构新增 `presetId`、`modelConfig`、`proxyUrl` 字段

- 🔧 **前端架构**
  - 新增 `McpDrawer.vue` / `McpFormDrawer.vue` MCP 管理组件
  - 新增 `PromptsDrawer.vue` / `PromptsFormDrawer.vue` 提示词管理组件
  - 新增 `SkillsPanel.vue` / `SkillCard.vue` / `SkillDetailModal.vue` 技能管理组件
  - 新增 `SpeedTestDrawer.vue` 速度测试组件
  - 新增 `EnvConflictModal.vue` 环境变量冲突弹窗
  - 新增 `claudePresets.js` 预设配置文件

---

## [1.6.0] - 2025-11-29

### 🎉 重大更新：多渠道负载均衡架构

### Added

- 🔀 **多渠道负载均衡**
  - 支持同时启用多个渠道，系统自动进行智能负载均衡
  - 支持为每个渠道配置**权重**（1-100），按权重分配请求流量
  - 支持为每个渠道配置**最大并发数**，精细控制每个渠道的负载
  - 基于加权随机算法，高权重渠道获得更多请求
- 🏥 **渠道健康检查与智能切换**
  - 自动检测渠道健康状态，连续失败自动冻结问题渠道
  - 冻结时间指数递增（1 分钟 → 2 分钟 → 4 分钟...最大 30 分钟）
  - 渠道恢复后自动解冻，无需人工干预
  - 一键重置渠道健康状态
- 🔗 **会话绑定模式**
  - 支持开启/关闭会话绑定，确保同一会话的请求发送到同一渠道
  - 避免上下文在不同渠道间切换导致的问题
- 📊 **首页三列布局拖拽排序**
  - Claude / Codex / Gemini 三列可自由拖拽调整顺序
  - 布局顺序自动保存，跨设备同步
- 🎨 **渠道卡片全新设计**
  - 新增权重和并发数显示
  - 新增健康状态指示器（健康/冻结/检查中）
  - 支持直接在卡片上快速调整权重和并发设置
  - 渠道启用/禁用状态切换

### Changed

- ⚠️ **移除"默认渠道"概念**
  - 不再需要手动切换默认渠道
  - 改为启用/禁用渠道，启用的渠道自动参与负载均衡
  - 代理启动时自动使用所有启用的渠道
- 🔄 **API 接口变更**
  - 移除 `/channels/activate` 接口
  - 移除 `/channels/active` 接口
  - 新增 `/channels/enabled` 接口获取所有启用的渠道
  - 渠道数据结构新增 `enabled`、`weight`、`maxConcurrency` 字段

### Improved

- ⚡ **性能优化**
  - 渠道数据内存缓存，减少文件 I/O
  - 首页数据并行加载，快速接口不被慢速接口阻塞
  - 统计数据异步计算，不影响首屏渲染
  - 会话列表虚拟滚动优化
- 🏗️ **代码架构优化**
  - 全新的调度器模块 `channel-scheduler.js`
  - 全新的健康检查模块 `channel-health.js`
  - 服务层代码结构重构，职责更清晰
  - Express 路由顺序优化，避免参数路由匹配问题
- 🎨 **UI/UX 改进**
  - 渠道面板视觉重新设计
  - 代理状态卡片信息更丰富
  - 实时日志面板性能优化
  - 整体圆角和间距微调

### Fixed

- 🐛 修复 CLI 添加 Codex/Gemini 渠道时参数不匹配的问题
- 🐛 修复 WebSocket 状态广播时渠道数据不一致的问题
- 🐛 修复代理启动时渠道验证逻辑
- 🐛 修复前端 API 调用与后端接口不匹配的问题

---

## [1.5.5] - 2025-01-12

### Improved

- ⚡ 性能优化：首页数据加载策略改进，快速接口不再被慢速接口阻塞
  - 前端并行加载所有数据，使用 `Promise.allSettled()` 替代 `Promise.all()`
  - 快速接口（UI 配置、频道列表）可立即返回和渲染
  - 慢速接口（今日统计）在后台并行加载，不影响首屏体验
- 🔧 优化版本检查逻辑
  - 使用 `requestIdleCallback` 延迟版本检查到浏览器空闲时
  - 添加 npm 注册表请求缓存，TTL 为 1 小时
  - 减少首页初始加载时间
- 🐛 修复问题
  - 移除版本检查的 mock 模式，恢复真实版本检测

---

## [1.5.4] - 2024-11-27

### Improved

- 🎨 全局圆角优化，主卡片从 12px 调整为 8px，内部小卡片 6px，按钮 4-5px，整体更现代简洁
- ✨ 优化 Logo 和导航标签的圆角设计，提升视觉精致度
- 📊 今日数据统计卡片样式精细调整，提升数据展示的视觉层级
- 🔒 锁定状态界面圆角优化，锁定图标容器从 16px 改为 10px
- 📱 列表项和标签圆角统一调整，提升整体设计一致性
- 🎯 按钮和选择器圆角细化，从 6px 优化为 4px，更具现代感

---

## [1.5.3] - 2024-11-26

### Added

- 🚀 新增 `ct daemon` 命令，支持后台运行模式（基于 PM2）
  - `ct daemon start` - 后台启动服务
  - `ct daemon stop` - 停止后台服务
  - `ct daemon restart` - 重启服务
  - `ct daemon status` - 查看运行状态
  - `ct daemon logs` - 查看 PM2 日志
- 🩺 新增 `ct doctor` 命令，系统健康诊断工具
  - 检查 Node.js 版本兼容性
  - 检查配置文件完整性
  - 检查端口占用情况
  - 检查 Claude Code 配置
  - 检查日志目录和磁盘空间
  - 检查进程运行状态
- 📋 新增 `ct logs` 命令，日志管理工具
  - `ct logs [type]` - 查看指定类型日志（ui/claude/codex/gemini）
  - `ct logs --follow` - 实时跟踪日志
  - `ct logs --lines N` - 显示最后 N 行
  - `ct logs --clear` - 清空日志文件
- 📊 新增 `ct stats` 命令，查看统计信息
  - 会话数量统计
  - Token 使用统计
  - API 调用次数统计
- ✨ 新增版本自动更新功能
  - 自动检测新版本
  - 一键更新并重启
  - 支持查看更新日志

### Improved

- 🎨 优化 Web UI 更新提示，支持 Markdown 格式的 changelog 展示
- 📦 改进日志管理，统一日志存储路径到 `~/.claude/logs/`
- ⚡ 优化命令行帮助信息，新增命令自动出现在 `ct --help` 中

### Fixed

- 🐛 修复后台运行模式下端口冲突问题
- 🐛 修复日志文件过大导致的性能问题

---

## [1.5.2] - 2024-11-26

### Added

- 🔒 新增类型锁定功能，可灵活关闭不需要的 AI 工具类型（Claude/Codex/Gemini），精简工作界面
- 🔖 新增强大的收藏功能，支持收藏关键对话至顶部书签栏，一键快速定位核心对话内容
- 🎯 新增后台运行模式，启动服务后可安全关闭终端窗口，代理服务持续运行无间断
- ⚙️ 新增高级开机自启配置，支持系统启动时自动启动代理服务，无需手动干预

### Improved

- ⚡ 优化首页数据加载性能，引入智能缓存机制，显著提升页面加载速度
- 📦 整合聚合 Dashboard 接口，减少多余请求，优化整体网络开销
- 🎨 微调 UI 细节，提升整体视觉体验和交互流畅度

### Fixed

- 🐛 修复会话运行时间计算逻辑，确保时间统计准确无误

---

## [1.5.1] - 2024-11-20

### Added

- 📢 新增版本更新提示，及时推送最新功能和改进

### Improved

- 🎨 优化更新提示 UI，完美适配日间/暗黑主题

### Fixed

- 🐛 修复更新提示弹窗在白天主题下背景色问题

---

## [1.5.0] - 2024-11-15

### Added

- 🤖 新增 Gemini AI 工具完整支持

### Improved

- 🎨 全面优化整体 UI 设计和交互体验

### Fixed

- 🐛 修复代理管理页面的已知问题

---

## [1.4.5] - 2024-11-10

### Added

- 🔖 新增收藏功能，快速标记重要会话

### Improved

- ⚡ 性能优化和响应速度提升

### Fixed

- 🐛 修复渠道切换问题

---

## [1.4.0] - 2024-11-05

### Added

- 📱 新增响应式设计，支持更多终端宽度
- 🔍 新增全局搜索功能，快速查找会话内容

### Improved

- 🎨 整体 UI 界面优化

### Fixed

- 🐛 修复若干已知问题
