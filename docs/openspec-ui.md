# OpenSpec UI 使用指南

本指南介绍如何在 CCToolbox 的 Web UI 中使用 OpenSpec 规范管理功能。

## 入口与前置条件

1. 确保项目根目录存在 `openspec/` 目录。
2. 进入 SessionList（项目详情）页面。
3. 点击搜索框左侧的 **OpenSpec** 按钮打开侧滑抽屉。

> 若按钮为灰色，请在项目根目录执行 `openspec init` 初始化。

## 功能概览

- **仪表盘**：查看规范数量、变更数量、归档数量与最近更新时间。
- **快捷入口**：Active Changes / Specifications 快速跳转。
- **项目**：快速访问 `AGENTS.md`、`project.md` 等核心文件。
- **规范**：以树形结构浏览 `openspec/specs`。
- **变更**：按目录查看 `openspec/changes`。
- **档案**：浏览 `openspec/changes/archive` 中的归档记录。
- **设置**：配置自动刷新、刷新间隔，并显示 CLI 版本与工具安装状态。

## 文件编辑

1. 在「项目/规范/档案」中选择文件。
2. 右侧内联编辑器打开 Markdown 内容。
3. 输入内容后 3 秒自动保存，或点击 **保存** 手动写入。
4. 大文件会标记为「大文件」，同步以差异化更新为主。

## UI 增强功能

- **进度条**：变更/档案列表项显示任务完成进度与已完成数量提示。
- **任务折叠**：变更详情的任务列表支持折叠，展示任务描述与分组完成情况。
- **预览/编辑**：项目详情支持预览与编辑模式切换，避免误操作。
- **关键词搜索**：变更、档案、规范列表支持标题与路径关键字搜索。
- **全屏层级修复**：详情页全屏展示始终位于遮罩层之上。

## 冲突处理

当检测到文件冲突时：

- **保留本地**：以本地编辑内容覆盖远程。
- **使用远程**：放弃本地编辑，应用远程内容。
- **手动合并**：手动整理后保存为合并版本。

## 同步机制

- **WebSocket 实时推送**：外部修改会自动同步到界面。
- **定时刷新**：默认每 15 秒刷新当前 Tab，可在设置中调整。

## 常见问题

### 1. OpenSpec 按钮不可用
- 检查项目根目录是否存在 `openspec/`。
- 确保 SessionList 中加载到最新的项目路径。

### 2. 保存失败或出现冲突
- 可能存在外部编辑，请按冲突提示选择处理方式。
- 保存前确保网络连接正常。

### 3. 文件内容未更新
- 点击右上角 **刷新** 按钮。
- 或在设置中开启自动刷新。
